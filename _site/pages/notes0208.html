
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Discussion 3 - 02/08</title>
    <meta name="description" content="notes, links, example code and exercises">
    <meta name="author" content="Peigen Zhou">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/main.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->

    <!-- atom & rss feed -->
    <link href="nil" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="nil" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Data Science Practicum - Stat 628 - Discussion</a>
          <ul class="nav">
              <li><a href="/pages/schedule.html">Schedule</a></li>
              <li><a href="/pages/topics.html">Topics</a></li>
          </ul>

        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h2>Discussion 3 - 02/08 </h2>
</div>

<div class="row-fluid">
  <div class="span12">
    <h2 id="sql-tutorial">SQL tutorial</h2>

<p>The following contents are from <a href="https://cs.brown.edu/courses/csci1951-a/slides/">cs1951A</a> and <a href="https://www.w3schools.com/sql/">w3school</a></p>

<p>SQL slides: <a href="https://cs.brown.edu/courses/csci1951-a/slides/files/2019-01-31-lecture2-sql1.pdf">Slides</a>
SQL assigment: <a href="https://cs.brown.edu/courses/csci1951-a/assignments/sql.html">Assignment</a></p>

<h3 id="basic-concepts">Basic concepts</h3>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Data_definition_language">Data definition language</a>: Define types and relation</li>
  <li>Data <a href="https://en.wikipedia.org/wiki/Data_manipulation_language">Manipulation</a> and <a href="https://en.wikipedia.org/wiki/Query_language">Query</a> language</li>
</ul>

<p><strong>basic logic: create a table or multiple and play with them.</strong></p>

<h3 id="data-types">Data types</h3>

<p>Reference: <a href="https://www.journaldev.com/16774/sql-data-types">SQL data types</a></p>

<p><img src="../assets/notesFigs/sql-data-types.png" alt="" />
<em>https://www.journaldev.com/16774/sql-data-types</em></p>

<h3 id="examples">Examples</h3>

<p><img src="../assets/notesFigs/twitter.png" alt="" />
<em>https://twitter.com/yezhengSTAT</em></p>

<p><img src="../assets/notesFigs/sql-twitters.png" alt="" />
<em>brown cs1951A</em></p>

<h2 id="sqlite3-in-python">SQLite3 in Python</h2>

<p>The following tutorial follows <a href="https://docs.python.org/3/library/sqlite3.html">sqlite3</a> 
If you know a more popular one, just let me know :)</p>

<h3 id="start-connect-to-sqlite3-server">Start connect to sqlite3 server</h3>

<p><a href="https://docs.python.org/3/library/sqlite3.html">Documentation</a></p>

<p>Python is an object-oriented language <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">OOP</a>, you should learn the basic concept for this term.</p>

<p>To run our <code class="highlighter-rouge">sqlite3</code>, you need to first connect to a local/remote database via <code class="highlighter-rouge">.connect(NAME)</code></p>

<p>Once you have a <a href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Connection">Connection</a>, you can create a <a href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Cursor">Cursor</a> object and call its <a href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Cursor.execute">execute()</a> method to perform SQL commands</p>

<pre><code class="language-Python"># Python3

conn = sqlite3.connect(NAME)
cursor_obj = conn.cursor()
cursor_obj.execute(SQL_COMMAND)
</code></pre>

<h3 id="create-a-table">Create a TABLE</h3>

<p>To create a <code class="highlighter-rouge">SQL TABLE</code>, first you need to <a href="https://www.w3schools.com/sql/sql_create_table.asp">CREAT TABLE</a>, also declare columns’ name and type</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--SQLite3</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
    <span class="n">column1</span> <span class="n">datatype</span><span class="p">,</span>
    <span class="n">column2</span> <span class="n">datatype</span><span class="p">,</span>
    <span class="n">column3</span> <span class="n">datatype</span><span class="p">,</span>
   <span class="p">....</span>
<span class="p">);</span>
</code></pre></div></div>

<p>In Python, if you want to run a sql command, you need to pass a string to <code class="highlighter-rouge">cursor.execute(SQL_COMMAND: string)</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Python3</span>

<span class="n">command</span> <span class="o">=</span> <span class="s">"""
CREATE TABLE table_name (
    column1 datatype,
    column2 datatype,
    column3 datatype,
   ....
);
"""</span>
<span class="n">cursor_obj</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="show-tables-in-current-database">Show tables in current database</h3>

<p>To show tables, in sqlite3 console you can use <code class="highlighter-rouge">.tables</code>, more command from <code class="highlighter-rouge">.help</code></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--SQLite3</span>

<span class="p">.</span><span class="n">tables</span>
</code></pre></div></div>

<p>or</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--SQLite3</span>

<span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">sqlite_master</span> <span class="k">WHERE</span> <span class="k">type</span><span class="o">=</span><span class="s1">'table'</span><span class="p">;</span>
</code></pre></div></div>

<p>Here the <code class="highlighter-rouge">SELECT</code> command is select object from database, once you executing a <code class="highlighter-rouge">SELECT</code> statement.</p>

<p>Equivalent, in python, we can do</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Python3</span>

<span class="n">command</span> <span class="o">=</span> <span class="s">"SELECT name FROM sqlite_master WHERE type='table';"</span>
<span class="n">cursor_obj</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cursor_obj</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
</code></pre></div></div>

<p>You can either treat the cursor as an <a href="https://docs.python.org/3/glossary.html#term-iterator">iterator</a>, call the cursor’s <a href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Cursor.fetchone">fetchone()</a> method to retrieve a single matching row, or call <a href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Cursor.fetchall">fetchall()</a> to get a list of the matching rows.</p>

<h3 id="insert-one-record-in-database">Insert one record in database</h3>

<p>Once we create our base table, we can start insert records into the database.</p>

<p>In sqlite3, it is possible to write the <code class="highlighter-rouge">INSERT INTO</code> statement in two ways.</p>

<p>The first way specifies both the column names and the values to be inserted:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--SQLite3</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value3</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div></div>

<p>or</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--SQLite3</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value3</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div></div>

<h2 id="relational-database">Relational database</h2>

<p>Different <a href="https://www.dotnettricks.com/learn/sqlserver/different-types-of-sql-keys">Key types</a></p>

<p><a href="https://www.w3schools.com/sql/sql_primarykey.asp"><strong>Primary key</strong></a> is a set of one or more fields/columns of a table that uniquely identify a record in database table. It can not accept null, duplicate values. Only one Candidate Key can be Primary Key.</p>

<p><a href="https://www.w3schools.com/sql/sql_foreignkey.asp"><strong>Foreign key</strong></a> is a field in database table that is Primary key in another table. It can accept multiple null, duplicate values. For more help refer the article <a href="http://www.dotnettricks.com/learn/sqlserver/difference-between-primary-key-and-foreign-key">Difference between primary key and foreign key</a>.</p>

<p><strong>Consider if you are hiring by amazon, how did you manage amazon data? how many tables do you need, how to link them together?</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--SQLite3</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Customers</span> <span class="p">(</span>
    <span class="n">CustomerID</span> <span class="n">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">Name</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Products</span> <span class="p">(</span>
    <span class="n">ProductID</span> <span class="n">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">price</span> <span class="n">NUMERIC</span><span class="p">,</span>
    <span class="n">original</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Orders</span> <span class="p">(</span>
    <span class="n">OrderID</span> <span class="n">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="k">size</span> <span class="n">INT</span><span class="p">,</span>
    <span class="n">CustomerID</span> <span class="n">INT</span><span class="p">,</span> 
    <span class="n">ProductID</span> <span class="n">INT</span><span class="p">,</span> 
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">CustomerID</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Customers</span><span class="p">(</span><span class="n">CustomerID</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ProductID</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Products</span><span class="p">(</span><span class="n">ProductID</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="why">Why?</h3>

<p>Link TABLES together!</p>

<h3 id="practice">Practice</h3>

<p>In the <a href="https://cs.brown.edu/courses/csci1951-a/assignments/sql.html">Assignment</a>, there is a database named people.db, with the name, age, ID, and occupation of some students. Here we can create these three tables by ourself.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>people_main(ID INTEGER, name TEXT, occupation TEXT, age INTEGER)
people_likes(ID1 INTEGER, ID2 INTEGER)
people_friends(ID1 INTEGER, ID2 INTEGER)
</code></pre></div></div>

<ol>
  <li>Create table <code class="highlighter-rouge">people_main</code>, <code class="highlighter-rouge">people_likes</code> and <code class="highlighter-rouge">people_friends</code>.</li>
  <li>Consider what is the primary key in <code class="highlighter-rouge">people_main</code>.</li>
</ol>

<p>The table <code class="highlighter-rouge">people_likes</code>, based on following roles:</p>

<ol>
  <li>ID1 and ID2 should from people_main table</li>
  <li>ID1 likes the person with ID2</li>
  <li>Suppose each person can only like one person</li>
</ol>

<p><strong>Should we have a key/keys for this table? If so, what type of key/keys?</strong></p>

<p><code class="highlighter-rouge">people_friends</code> should based on:</p>

<ol>
  <li>ID1 and ID2 should from people_main table</li>
  <li>ID1 != ID2</li>
  <li>If person with ID1 is friend with ID2, the revers should also be true</li>
</ol>

<p><strong>How about people_friends?</strong></p>

<p><a href="../assets/python/sql.zip">Practice</a></p>

  </div>
</div>


      </div>
      <hr>
      <footer>
        <p><small>
          <!-- start of footer -->
          &copy Spring 2019 &nbsp;-&nbsp;
          <a href="http://peigenzhou.com">Peigen Zhou</a> &nbsp;
          Themes based on  <a href="http://cecileane.github.io/computingtools/">Stat 679</a> &nbsp;and <a href="http://kbroman.org/">Karl Broman</a>
          <!-- end of footer -->
        </small></p>
      </footer>

    </div>

    
  </body>
</html>

